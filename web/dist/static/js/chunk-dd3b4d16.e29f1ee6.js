(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-dd3b4d16"],{"1b45":function(t,e,s){"use strict";s("eba7")},"5cbe":function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"task-detail"},[s("el-card",{attrs:{shadow:"hover"}},[s("div",{staticClass:"detail-header"},[s("h2",[t._v("实时日志输出")]),s("div",{staticClass:"header-buttons"},[s("el-button",{attrs:{type:"success",icon:"el-icon-refresh"},on:{click:t.refreshLogs}},[t._v("刷新日志")]),s("el-button",{attrs:{type:"info",icon:"el-icon-download"},on:{click:t.exportLogs}},[t._v("导出日志")]),s("el-button",{attrs:{type:"danger",icon:"el-icon-close"},on:{click:t.closeAll}},[t._v("关闭连接")])],1)]),s("div",{staticClass:"logs-container"},[s("div",{staticClass:"log-marquee"},[s("div",{staticClass:"marquee-content"},[t._v(" 🔍 提醒：日志只存储于前端缓存，关闭浏览器页面会丢失，建议及时导出保存！ ")])]),s("div",{staticClass:"log-section"},[s("div",{staticClass:"log-title"},[t._v("🧩 Xray 扫描日志")]),s("div",{ref:"xrayBox",staticClass:"log-box"},[s("pre",[t._v(t._s(t.xrayLogs.join("\n")))])])]),s("div",{staticClass:"log-section"},[s("div",{staticClass:"log-title"},[t._v("🕷️ 爬虫 Crawlergo 日志")]),s("div",{ref:"crawlergoBox",staticClass:"log-box"},[s("pre",[t._v(t._s(t.crawlergoLogs.join("\n")))])])])])])],1)},n=[],r=s("c14f"),a=s("1da1"),c=(s("99af"),s("caad"),s("a15b"),s("e9c4"),s("b64b"),s("d3b7"),s("2532"),s("3ca3"),s("ddb0"),s("2b3d"),s("bf19"),s("9861"),s("b199")),i={props:["id"],data:function(){return{xrayLogs:[],crawlergoLogs:[],sseXray:null,sseCrawlergo:null,task:null}},mounted:function(){this.restoreLogsFromCache(),this.loadTask()},beforeDestroy:function(){this.saveLogsToCache(),this.closeAll()},methods:{cacheKey:function(t){return"task_logs_".concat(this.id,"_").concat(t)},saveLogsToCache:function(){sessionStorage.setItem(this.cacheKey("xray"),JSON.stringify(this.xrayLogs)),sessionStorage.setItem(this.cacheKey("crawlergo"),JSON.stringify(this.crawlergoLogs))},restoreLogsFromCache:function(){var t=sessionStorage.getItem(this.cacheKey("xray")),e=sessionStorage.getItem(this.cacheKey("crawlergo"));t&&(this.xrayLogs=JSON.parse(t)),e&&(this.crawlergoLogs=JSON.parse(e))},loadTask:function(){var t=this;return Object(a["a"])(Object(r["a"])().m((function e(){var s,o;return Object(r["a"])().w((function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Object(c["d"])(t.id);case 1:s=e.v,s?(t.task=s,t.initSSE()):t.$message.warning("未找到该任务（ID: ".concat(t.id,"）")),e.n=3;break;case 2:e.p=2,o=e.v,console.error("加载任务详情出错:",o),t.$message.error("加载任务详情失败");case 3:return e.a(2)}}),e,null,[[0,2]])})))()},initSSE:function(){var t,e,s=this,o=(null===(t=this.task)||void 0===t?void 0:t.xyport)||7777,n=(null===(e=this.task)||void 0===e?void 0:e.crawlerid)||this.id,r=encodeURIComponent("XRAY-OUT[".concat(o,"]")),a=encodeURIComponent("CRAWLERGO-ERR[".concat(n,"]"));this.sseXray=new EventSource("/sse/logs?tag=".concat(r)),this.sseCrawlergo=new EventSource("/sse/logs?tag=".concat(a)),this.sseXray.onmessage=function(t){s.xrayLogs.push(t.data),s.saveLogsToCache(),t.data.includes("All pending requests have been scanned")&&(s.sseXray.close(),s.$message.success("Xray 扫描完成")),s.$nextTick((function(){return s.scrollToBottom("xrayBox")}))},this.sseCrawlergo.onmessage=function(t){s.crawlergoLogs.push(t.data),s.saveLogsToCache(),t.data.includes("Task finished")&&(s.sseCrawlergo.close(),s.$message.success("Crawlergo 扫描完成")),s.$nextTick((function(){return s.scrollToBottom("crawlergoBox")}))},this.sseXray.onerror=function(t){return console.error("[SSE] Xray error",t)},this.sseCrawlergo.onerror=function(t){return console.error("[SSE] Crawlergo error",t)}},scrollToBottom:function(t){var e=this.$refs[t];e&&(e.scrollTop=e.scrollHeight)},closeAll:function(){this.sseXray&&this.sseXray.close(),this.sseCrawlergo&&this.sseCrawlergo.close(),this.$message.info("SSE连接已关闭")},refreshLogs:function(){this.closeAll(),this.initSSE(),this.$message.success("日志已刷新")},exportLogs:function(){var t=["=== XRAY 日志 ===",this.xrayLogs.join("\n"),"","=== CRAWLERGO 日志 ===",this.crawlergoLogs.join("\n")].join("\n"),e=new Blob([t],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(e),o=document.createElement("a");o.href=s,o.download="scan_logs_".concat(this.id,".txt"),o.click(),URL.revokeObjectURL(s),this.$message.success("日志已导出")}}},u=i,l=(s("1b45"),s("2877")),d=Object(l["a"])(u,o,n,!1,null,"0cd51ea4",null);e["default"]=d.exports},a15b:function(t,e,s){"use strict";var o=s("23e7"),n=s("44ad"),r=s("fc6a"),a=s("a640"),c=[].join,i=n!=Object,u=a("join",",");o({target:"Array",proto:!0,forced:i||!u},{join:function(t){return c.call(r(this),void 0===t?",":t)}})},b199:function(t,e,s){"use strict";s.d(e,"e",(function(){return r})),s.d(e,"d",(function(){return a})),s.d(e,"b",(function(){return c})),s.d(e,"a",(function(){return i})),s.d(e,"c",(function(){return u})),s.d(e,"j",(function(){return l})),s.d(e,"g",(function(){return d})),s.d(e,"f",(function(){return g})),s.d(e,"h",(function(){return f})),s.d(e,"i",(function(){return h}));s("99af"),s("e9c4"),s("ac1f"),s("00b4");var o=s("2ade"),n="api/tasks";function r(t,e,s){return o["a"].get("".concat(n),{params:{page:t,size:e,source:s}})}function a(t){return o["a"].get("".concat(n,"/get"),{params:{taskId:t}})}function c(t){return o["a"].post("".concat(n),t)}function i(t){return o["a"].post("".concat(n,"/batch"),t)}function u(t){var e=/^[0-9]+$/.test(t),s=e?"".concat(n,"/").concat(t):"".concat(n,"/group/").concat(t);return o["a"].delete(s)}function l(t,e){return o["a"].put("".concat(n,"/").concat(t,"/status"),JSON.stringify(e),{headers:{"Content-Type":"application/json"}})}function d(t,e){return o["a"].get("".concat(n,"/").concat(t,"/startTask?source=").concat(e))}function g(t,e){return o["a"].get("".concat(n,"/").concat(t,"/startTaskBygroup?source=").concat(e))}function f(t){var e=/^[0-9]+$/.test(t),s=e?"".concat(n,"/").concat(t,"/stopTask"):"".concat(n,"/stopTaskByGroup");return o["a"].get(s,{params:{id:t}})}function h(t){return o["a"].post("".concat(n,"/task/edit"),t)}},e9c4:function(t,e,s){var o=s("23e7"),n=s("d066"),r=s("d039"),a=n("JSON","stringify"),c=/[\uD800-\uDFFF]/g,i=/^[\uD800-\uDBFF]$/,u=/^[\uDC00-\uDFFF]$/,l=function(t,e,s){var o=s.charAt(e-1),n=s.charAt(e+1);return i.test(t)&&!u.test(n)||u.test(t)&&!i.test(o)?"\\u"+t.charCodeAt(0).toString(16):t},d=r((function(){return'"\\udf06\\ud834"'!==a("\udf06\ud834")||'"\\udead"'!==a("\udead")}));a&&o({target:"JSON",stat:!0,forced:d},{stringify:function(t,e,s){var o=a.apply(null,arguments);return"string"==typeof o?o.replace(c,l):o}})},eba7:function(t,e,s){}}]);